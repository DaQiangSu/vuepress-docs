(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{380:function(s,a,t){"use strict";t.r(a);var e=t(25),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"filebeat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#filebeat"}},[s._v("#")]),s._v(" Filebeat")]),s._v(" "),t("h3",{attrs:{id:"linux安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#linux安装"}},[s._v("#")]),s._v(" Linux安装")]),s._v(" "),t("blockquote",[t("p",[s._v("下载安装包并解压")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://mirrors.huaweicloud.com/filebeat/7.9.1/filebeat-7.9.1-linux-x86_64.tar.gz\n")])])]),t("blockquote",[t("p",[s._v("解压")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf filebeat-7.9.1-linux-x86_64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" filebeat-7.9.1-linux-x86_64 filebeat\n")])])]),t("blockquote",[t("p",[s._v("说明")])]),s._v(" "),t("p",[s._v("filebeat下面有很多模块，需要用哪个模块，直接运行下面相应的命令即可")]),s._v(" "),t("blockquote",[t("p",[s._v("更改filebeat的配置")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" filebeat\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" filebeat.yml\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可不配置")]),s._v("\nfilebeat.inputs:\n\tpaths:\n    - /nginx/logs/*.log\n\noutput.elasticsearch:\n\thosts: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:9200"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  \tusername: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elastic"')]),s._v("\n  \tpassword: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elastic"')]),s._v("\nsetup.kibana:\n  \thost: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1/elk"')]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("开启某个模块(Nginx为例)")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" filebeat\n./filebeat modules "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nginx\n")])])]),t("blockquote",[t("p",[s._v("更改Nginx.yml配置")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" modules.d/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" nginx.yml\naccess:\n    enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\tvar.paths: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/nginx/logs/access.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nerror:\n    enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\tvar.paths: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/nginx/logs/error.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("配置和启动")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./filebeat setup\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#稍等一会，等待配置")]),s._v("\n./filebeat -e\n")])])]),t("blockquote",[t("p",[s._v("查看数据")])]),s._v(" "),t("p",[s._v("查看binana控制台端口5601")]),s._v(" "),t("blockquote",[t("p",[s._v("开启MySQL模块")])]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd filebeat\n./filebeat modules enable mysql\n")])])]),t("blockquote",[t("p",[s._v("开启慢SQL查询功能")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启慢SQL查询")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slow_query_log")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定慢SQL收集文件地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("slow_query_log_file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/log/mysql/slow_query.log\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#临界值，执行时间为多久判定为慢SQL")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("long_query_time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#记录没有使用索引的查询")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("log_queries_not_using_indexes")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ON\n")])])]),t("blockquote",[t("p",[s._v("开启慢SQL时需要注意的")])]),s._v(" "),t("ol",[t("li",[s._v("慢SQL收集文件不存在，要手动创建")]),s._v(" "),t("li",[s._v("要进行给文件赋予权限：chmod 777 slow_query.log")]),s._v(" "),t("li",[s._v("如果加了权限还不行，需要执行：setenforce 0，强制关闭 vim /etc/selinux/config，修改SELINUX=disabled")]),s._v(" "),t("li",[s._v("修改完需要重启MySQL")])]),s._v(" "),t("blockquote",[t("p",[s._v("更改mysql.yml配置")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v(" error:\n    enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    var.paths: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/mysqld.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  slowlog:\n    enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    var.paths: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/mysql/slow_query.log"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("配置和启动")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./filebeat setup\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#稍等一会，等待配置")]),s._v("\n./filebeat -e\n")])])]),t("blockquote",[t("p",[s._v("辅助命令")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查询慢SQL文件所在位置")]),s._v("\n show variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slow_query_log_file'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查询慢SQL多长时间开始记录（临界值）")]),s._v("\n show variables like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'long_query_time'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看错误日志位置")]),s._v("\n SHOW VARIABLES LIKE "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'log_error'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查询慢SQL数量")]),s._v("\n show global status like "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%slow%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h3",{attrs:{id:"window安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#window安装"}},[s._v("#")]),s._v(" Window安装")])])}),[],!1,null,null,null);a.default=n.exports}}]);